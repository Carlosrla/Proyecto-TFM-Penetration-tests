import subprocess
import json
import os

def search_exploits(service_name, service_version, output_file="results/exploits.json"):
    """
    Busca exploits para un servicio y versión específicos usando searchsploit.
    :param service_name: Nombre del servicio (por ejemplo, "ssh").
    :param service_version: Versión del servicio (por ejemplo, "2019.78").
    :param output_file: Ruta para guardar los resultados.
    """
    # Asegurarse de que el directorio "results" exista
    os.makedirs(os.path.dirname(output_file), exist_ok=True)

    print(f"[+] Buscando exploits para {service_name} {service_version}...")
    search_command = ["searchsploit", service_name, service_version, "--json"]
    try:
        search_output = subprocess.run(search_command, capture_output=True, text=True, check=True)
        exploits = json.loads(search_output.stdout)
        
        # Guardar los resultados en un archivo JSON
        if exploits:  # Verificar que hay exploits
            with open(output_file, "w") as f:
                json.dump(exploits, f, indent=4)
            print(f"[+] Exploits guardados en {output_file}")
        else:
            print("[-] No se encontraron exploits.")
    except subprocess.CalledProcessError as e:
        print(f"[-] Error buscando exploits: {e}")